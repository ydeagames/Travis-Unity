language: objective-c

branches:
  only:
    - alfa
    - beta
    - stable

os: osx
osx_image: xcode8.3

rvm:
  - 2.2

addons:
  - sonarcloud:
    organization: "ydeagames-github"
  - apt:
    packages:
      - oracle-java8-set-default

env:
  global:
    - ANDROID_SDK_ROOT=/usr/local/share/android-sdk
    - ANDROID_NDK_HOME=/usr/local/share/android-ndk

cache:
  - directories:
    # Homebrew    
    - $HOME/Library/Caches/Homebrew
    # Android
    - $ANDROID_SDK_ROOT
    - $ANDROID_NDK_HOME
    # Unity
    - ./Unity
    - $HOME/Library/Caches/com.unity3d.UnityEditor/GiCache
  - timeout: 1000

install:
  - brew install tree
  - sh ./Travis/install.sh
#  - sh ./Travis/install_android.sh
  - brew cask install fastlane
  - export PATH="$HOME/.fastlane/bin:$PATH"

script:
  - sonar-scanner
  - tree
  - sh ./Travis/build.sh
  - tree
  # iOS
  - cd ./Build/ios
  - fastlane init
  - cat ./Fastfile
  - cd ../../
  - tree

after_success:
  - sh ./Travis/tag.sh

deploy:
  - provider: releases
    api_key: $GIT_TOKEN
    file: 
      - ./Build/windows.zip
      - ./Build/linux.tar.gz
      - ./Build/android.apk
      - ./Build/osx.dmg
      - ./Build/ios.zip
      # - ./Build/ios.ipa
    name: $TRAVIS_BRANCH $(date +'%Y.%m.%d %H:%M')
    skip_cleanup: true
    on:
      all_branches: true

#  - provider: pages
#    skip-cleanup: true
#    github-token: $GIT_TOKEN
#    local-dir: ./Build/webgl/
#    keep-history: true
#    on:
#      branch: stable

notifications:
  email: true